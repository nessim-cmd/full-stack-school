generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
  output          = "../src/generated/prisma-client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["application_service"]
}

model Application {
  id              String            @id @default(uuid())
  schoolId        String
  applicationNo   String            @unique
  
  // Student Information
  firstName       String
  lastName        String
  email           String
  phone           String?
  dateOfBirth     DateTime
  gender          String
  address         String?
  city            String?
  state           String?
  country         String?
  postalCode      String?
  nationality     String?
  
  // Academic Information
  previousSchool  String?
  gradeApplying   Int
  academicYear    String            // "2024-2025"
  
  // Parent/Guardian Information
  parentName      String
  parentEmail     String
  parentPhone     String
  parentRelation  String            // "father", "mother", "guardian"
  
  // Documents
  documents       ApplicationDocument[]
  
  // Status
  status          ApplicationStatus @default(PENDING)
  reviewNotes     String?           @db.Text
  reviewedBy      String?
  reviewedAt      DateTime?
  
  // Admission
  admissionDate   DateTime?
  studentId       String?           // After admission
  
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  
  @@index([schoolId])
  @@index([status])
  @@index([applicationNo])
  @@schema("application_service")
}

model ApplicationDocument {
  id            String      @id @default(uuid())
  applicationId String
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  name          String
  type          String      // "birth_certificate", "transcript", "photo", etc.
  url           String
  uploadedAt    DateTime    @default(now())
  
  @@schema("application_service")
}

model AdmissionCriteria {
  id           String   @id @default(uuid())
  schoolId     String   @unique
  gradeId      Int?
  
  // Requirements
  minAge       Int?
  maxAge       Int?
  requiredDocs String[] // List of required document types
  entranceExam Boolean  @default(false)
  interview    Boolean  @default(false)
  
  // Capacity
  maxStudents  Int?
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@schema("application_service")
}

model EntranceExam {
  id            String   @id @default(uuid())
  schoolId      String
  applicationId String
  examDate      DateTime
  examType      String   // "written", "online", "oral"
  subjects      String[]
  score         Float?
  maxScore      Float    @default(100)
  passed        Boolean?
  remarks       String?
  
  conductedBy   String?
  conductedAt   DateTime?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([schoolId])
  @@index([applicationId])
  @@schema("application_service")
}

model Interview {
  id            String   @id @default(uuid())
  schoolId      String
  applicationId String
  scheduledDate DateTime
  interviewers  String[]
  status        InterviewStatus @default(SCHEDULED)
  rating        Int?     // 1-5
  feedback      String?  @db.Text
  
  conductedAt   DateTime?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([schoolId])
  @@index([applicationId])
  @@schema("application_service")
}

enum ApplicationStatus {
  PENDING
  UNDER_REVIEW
  DOCUMENTS_REQUIRED
  EXAM_SCHEDULED
  INTERVIEW_SCHEDULED
  APPROVED
  REJECTED
  WAITLISTED
  ADMITTED
  WITHDRAWN
  
  @@schema("application_service")
}

enum InterviewStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  NO_SHOW
  
  @@schema("application_service")
}
