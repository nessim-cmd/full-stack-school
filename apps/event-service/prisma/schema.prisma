generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
  output          = "../src/generated/prisma-client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["event_service"]
}

model Event {
  id          String    @id @default(uuid())
  schoolId    String
  title       String
  description String?   @db.Text
  startDate   DateTime
  endDate     DateTime
  allDay      Boolean   @default(false)
  location    String?
  type        EventType @default(OTHER)
  color       String?   @default("#3b82f6")
  
  // Visibility
  isPublic    Boolean   @default(false)
  classId     Int?
  gradeId     Int?
  
  // Recurring
  isRecurring Boolean   @default(false)
  recurrence  Json?     // { frequency: 'daily'|'weekly'|'monthly', interval: number, until: Date }
  
  // Reminders
  reminderSent Boolean  @default(false)
  
  createdBy   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  attendees   EventAttendee[]
  
  @@index([schoolId])
  @@index([startDate, endDate])
  @@index([classId])
  @@schema("event_service")
}

model EventAttendee {
  id        String           @id @default(uuid())
  eventId   String
  event     Event            @relation(fields: [eventId], references: [id], onDelete: Cascade)
  userId    String
  userType  String           // "teacher", "student", "parent"
  status    AttendeeStatus   @default(PENDING)
  
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  
  @@unique([eventId, userId])
  @@index([userId])
  @@schema("event_service")
}

model Holiday {
  id          String   @id @default(uuid())
  schoolId    String
  name        String
  date        DateTime
  endDate     DateTime?
  type        HolidayType @default(SCHOOL_HOLIDAY)
  description String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([schoolId])
  @@index([date])
  @@schema("event_service")
}

model AcademicCalendar {
  id           String   @id @default(uuid())
  schoolId     String   @unique
  academicYear String   // "2024-2025"
  startDate    DateTime
  endDate      DateTime
  
  terms        Term[]
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@schema("event_service")
}

model Term {
  id           String   @id @default(uuid())
  calendarId   String
  calendar     AcademicCalendar @relation(fields: [calendarId], references: [id], onDelete: Cascade)
  name         String   // "Term 1", "Semester 1"
  startDate    DateTime
  endDate      DateTime
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@schema("event_service")
}

enum EventType {
  ACADEMIC
  SPORTS
  CULTURAL
  HOLIDAY
  EXAM
  MEETING
  PARENT_TEACHER
  WORKSHOP
  OTHER
  
  @@schema("event_service")
}

enum AttendeeStatus {
  PENDING
  ACCEPTED
  DECLINED
  
  @@schema("event_service")
}

enum HolidayType {
  PUBLIC_HOLIDAY
  SCHOOL_HOLIDAY
  STAFF_ONLY
  EXAM_BREAK
  
  @@schema("event_service")
}
