generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
  output          = "../src/generated/prisma-client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["platform_admin_service"]
}

model SuperAdmin {
  id          String   @id @default(uuid())
  email       String   @unique
  password    String
  firstName   String
  lastName    String
  phone       String?
  avatar      String?
  role        String   @default("super_admin")
  permissions String[] @default(["all"])
  
  isActive    Boolean  @default(true)
  lastLogin   DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@schema("platform_admin_service")
}

model PlatformSettings {
  id                    String   @id @default(uuid())
  
  // General
  platformName          String   @default("School Management Platform")
  platformLogo          String?
  supportEmail          String?
  supportPhone          String?
  
  // Registration
  allowNewRegistrations Boolean  @default(true)
  requireEmailVerification Boolean @default(true)
  
  // Default Settings
  defaultTimezone       String   @default("UTC")
  defaultCurrency       String   @default("USD")
  defaultLanguage       String   @default("en")
  
  // Limits
  maxSchoolsPerPlan     Json?    // { "starter": 1, "professional": 5, "enterprise": -1 }
  maxStudentsPerSchool  Json?    // { "starter": 100, "professional": 500, "enterprise": -1 }
  
  // Features
  enabledFeatures       String[] @default(["basic"])
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  @@schema("platform_admin_service")
}

model SubscriptionPlan {
  id              String   @id @default(uuid())
  name            String   @unique
  displayName     String
  description     String?
  
  // Pricing
  monthlyPrice    Float    @default(0)
  yearlyPrice     Float    @default(0)
  currency        String   @default("USD")
  
  // Features
  features        String[]
  maxStudents     Int      @default(-1) // -1 for unlimited
  maxTeachers     Int      @default(-1)
  maxClasses      Int      @default(-1)
  storageGB       Int      @default(10)
  
  // Modular Services
  enabledServices String[] @default([])
  
  // Status
  isActive        Boolean  @default(true)
  isPopular       Boolean  @default(false)
  sortOrder       Int      @default(0)
  
  subscriptions   Subscription[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@schema("platform_admin_service")
}

model Subscription {
  id              String   @id @default(uuid())
  schoolId        String   @unique
  planId          String
  plan            SubscriptionPlan @relation(fields: [planId], references: [id])
  
  // Status
  status          SubscriptionStatus @default(ACTIVE)
  startDate       DateTime @default(now())
  endDate         DateTime?
  trialEndsAt     DateTime?
  
  // Billing
  billingCycle    BillingCycle @default(MONTHLY)
  nextBillingDate DateTime?
  
  // Payment
  stripeCustomerId    String?
  stripeSubscriptionId String?
  
  // Usage
  currentStudents Int @default(0)
  currentTeachers Int @default(0)
  currentStorageGB Float @default(0)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@schema("platform_admin_service")
}

model AuditLog {
  id          String   @id @default(uuid())
  userId      String
  userType    String   // "super_admin", "admin", "system"
  action      String   // "create", "update", "delete", "login", etc.
  resource    String   // "school", "subscription", "settings", etc.
  resourceId  String?
  details     Json?
  ipAddress   String?
  userAgent   String?
  
  createdAt   DateTime @default(now())
  
  @@index([userId])
  @@index([action])
  @@index([resource])
  @@index([createdAt])
  @@schema("platform_admin_service")
}

model SystemMetric {
  id          String   @id @default(uuid())
  name        String
  value       Float
  unit        String?
  tags        Json?
  
  recordedAt  DateTime @default(now())
  
  @@index([name])
  @@index([recordedAt])
  @@schema("platform_admin_service")
}

enum SubscriptionStatus {
  ACTIVE
  TRIALING
  PAST_DUE
  CANCELLED
  SUSPENDED
  EXPIRED
  
  @@schema("platform_admin_service")
}

enum BillingCycle {
  MONTHLY
  YEARLY
  LIFETIME
  
  @@schema("platform_admin_service")
}
